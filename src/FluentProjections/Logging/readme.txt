The logging code is kindly provided by Damian Hickey.
Publicly available at https://github.com/damianh/DH.Logging